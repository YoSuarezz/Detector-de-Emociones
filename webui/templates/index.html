<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Detector - Web UI mejorado</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { padding: 1.5rem; }
    #outimg { max-height: 300px; object-fit: contain; border-radius: 6px; cursor: pointer; }
    .badge-emo { margin-right: 6px; }
    .card-section { margin-bottom: 1rem; }
    /* Spinner oculto por defecto; usamos flexbox cuando se muestre desde JS */
    .spinner-overlay{
      position:fixed;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      background:rgba(255,255,255,0.6);
      z-index:1050;
    }
  </style>
</head>
<body>
<div class="container">
  <h2 class="mb-3">Detector de Emociones — Web UI</h2>

  <div class="row">
    <div class="col-md-6">
      <div class="card card-section">
        <div class="card-body">
          <h5 class="card-title">Subir audio</h5>
          <form id="upload-form">
            <div class="mb-2">
              <input class="form-control" type="file" id="wavfile" name="wavfile" accept="audio/*" required>
            </div>
            <div class="mb-2">
              <input class="form-control" type="text" id="ckpt" name="ckpt" placeholder="Checkpoint (relativo a la raiz)" value="model_final.pth">
            </div>
            <div class="d-flex gap-2">
              <button class="btn btn-primary" type="submit">Analizar</button>
              <button class="btn btn-outline-secondary" id="clear-history" type="button">Limpiar historial</button>
            </div>
          </form>
        </div>
      </div>

      <div class="card card-section">
        <div class="card-body">
          <h6>Salida (texto)</h6>
          <pre id="stdout" class="small"></pre>
          <pre id="stderr" class="small text-danger"></pre>
        </div>
      </div>

      <div class="card card-section">
        <div class="card-body">
          <h6>Top emociones y género</h6>
          <div id="badges" class="mb-2"></div>
          <div id="gender-badge"></div>
        </div>
      </div>

      <div class="card card-section">
        <div class="card-body">
          <h6>Historial (local)</h6>
          <ul id="history" class="list-group small"></ul>
        </div>
      </div>

    </div>

    <div class="col-md-6">
      <div class="card card-section">
        <div class="card-body">
          <h6>Gráficas</h6>
          <canvas id="emoChart" style="max-height:260px"></canvas>
          <canvas id="genChart" style="max-height:180px; margin-top:12px"></canvas>
        </div>
      </div>

      <div class="card card-section">
        <div class="card-body text-center">
          <h6>Gráfica combinada (imagen generada)</h6>
          <img id="outimg" src="" alt="output image" style="display:none;" class="img-fluid" />
          <div class="mt-2 small text-muted">Haz click en la imagen para ver en grande</div>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- Modal para imagen en grande -->
<div class="modal fade" id="imgModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-body p-0">
        <img id="modalImg" src="" style="width:100%; height:auto; display:block;"/>
      </div>
    </div>
  </div>
</div>

<!-- Spinner overlay: NO tiene d-flex por defecto -->
<div class="spinner-overlay" id="spinner">
  <div class="spinner-border" role="status"><span class="visually-hidden">Cargando...</span></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="/static/main.js"></script>
</body>
</html>
